AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: A SAM/CF template to create contact function, API and DynamoDB table
Globals:
  Function:
    Timeout: 25
Resources:
  ContactFn:
    Type: AWS::Serverless::Function
    Properties:
      Description: function to perform CRUD operation on contacts
      FunctionName: ContactHandler
      Architectures:
      - x86_64
      CodeUri: ContactFn
      Handler: contactAPI.lambda_handler
      Runtime: python3.11
      Timeout: 15
      MemorySize: 128
      Policies:
      - AWSLambdaExecute
      - DynamoDBCrudPolicy:
          TableName: contacts
      Events:
        createConteact:
          Type: Api
          Properties:
            Path: /createContact
            Method: post
            RestApiId:
              Ref: ContactApi
        getConteacts:
          Type: Api
          Properties:
            Path: /allContacts
            Method: get
            RestApiId:
              Ref: ContactApi
        getConteact:
          Type: Api
          Properties:
            Path: /contact
            Method: get
            RestApiId:
              Ref: ContactApi
        updateConteact:
          Type: Api
          Properties:
            Path: /updateContact
            Method: put
            RestApiId:
              Ref: ContactApi
        deleteConteact:
          Type: Api
          Properties:
            Path: /deleteContact
            Method: delete
            RestApiId:
              Ref: ContactApi
    Metadata:
      SamResourceId: ContactFn
  ContactApi:
    Type: AWS::Serverless::Api
    Properties:
      Description: Rest API to call Contact lambda function
      Name: ContactAPI
      StageName: dev
      EndpointConfiguration:
        Type: REGIONAL
      FailOnWarnings: true
Outputs:
  contactFunction:
    Description: display the function name created by SAM
    Value:
      Ref: ContactFn
  createContactAPIEndpoint:
    Description: Create Contact API dev stage Endpoint
    Value:
      Fn::Sub: https://${ContactApi}.execute-api.${AWS::Region}.amazonaws.com/dev/createContact
  getAllContactsAPIEndpoint:
    Description: get all Contacts API dev stage Endpoint
    Value:
      Fn::Sub: https://${ContactApi}.execute-api.${AWS::Region}.amazonaws.com/dev/allContacts
  getContactAPIEndpoint:
    Description: get a  Contact by phone API dev stage Endpoint
    Value:
      Fn::Sub: https://${ContactApi}.execute-api.${AWS::Region}.amazonaws.com/dev/contact
  updateContactAPIEndpoint:
    Description: update a  Contact by phone API dev stage Endpoint
    Value:
      Fn::Sub: https://${ContactApi}.execute-api.${AWS::Region}.amazonaws.com/dev/updateContact
  deleteContactAPIEndpoint:
    Description: delete a  Contact by phone API dev stage Endpoint
    Value:
      Fn::Sub: https://${ContactApi}.execute-api.${AWS::Region}.amazonaws.com/dev/deleteContact
